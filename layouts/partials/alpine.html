{{ $mainjs := resources.Get "js/alpine.js" | js.Build }}
<script src="{{ $mainjs.RelPermalink }}" defer></script>
<script>
    function carousel() {
      return {
        init() {
          
        },
        scrollLeft() {
          this.$refs.carousel.scrollBy({ left: -300, behavior: 'smooth' });
        },
        scrollRight() {
          this.$refs.carousel.scrollBy({ left: 300, behavior: 'smooth' });
        },
      }
    }
</script>
<script>
  document.addEventListener('alpine:init', () => {
      Alpine.data('vietnameseAlphabet', () => ({
          currentVideo: null,
          currentLetter: null,
          
          alphabet: [
              { character: 'A', video: 'https://www.youtube.com/embed/VIDEO_ID_A' },
              { character: 'Ă', video: 'https://www.youtube.com/embed/VIDEO_ID_AW'},
              { character: 'Â', video: 'https://www.youtube.com/embed/VIDEO_ID_UH'},
              { character: 'B', video: 'https://www.youtube.com/embed/VIDEO_ID_B' },
              { character: 'C', video: 'https://www.youtube.com/embed/VIDEO_ID_C' },
              { character: 'D', video: 'https://www.youtube.com/embed/VIDEO_ID_D' },
              { character: 'Đ', video: 'https://www.youtube.com/embed/VIDEO_ID_DD' },
              { character: 'E', video: 'https://www.youtube.com/embed/VIDEO_ID_E'},
              { character: 'Ê', video: 'https://www.youtube.com/embed/VIDEO_ID_EY'},
              { character: 'F', video: 'https://www.youtube.com/embed/VIDEO_ID_F' },
              { character: 'G', video: 'https://www.youtube.com/embed/VIDEO_ID_G' },
              { character: 'H', video: 'https://www.youtube.com/embed/VIDEO_ID_H' },
              { character: 'I', video: 'https://www.youtube.com/embed/VIDEO_ID_I'},
              { character: 'K', video: 'https://www.youtube.com/embed/VIDEO_ID_K' },
              { character: 'L', video: 'https://www.youtube.com/embed/VIDEO_ID_L' },
              { character: 'M', video: 'https://www.youtube.com/embed/VIDEO_ID_M' },
              { character: 'N', video: 'https://www.youtube.com/embed/VIDEO_ID_N' },
              { character: 'O', video: 'https://www.youtube.com/embed/VIDEO_ID_O'},
              { character: 'Ô', video: 'https://www.youtube.com/embed/VIDEO_ID_OH'},
              { character: 'Ơ', video: 'https://www.youtube.com/embed/VIDEO_ID_UHOH'},
              { character: 'P', video: 'https://www.youtube.com/embed/VIDEO_ID_P' },
              { character: 'Q', video: 'https://www.youtube.com/embed/VIDEO_ID_Q' },
              { character: 'R', video: 'https://www.youtube.com/embed/VIDEO_ID_R' },
              { character: 'S', video: 'https://www.youtube.com/embed/VIDEO_ID_S' },
              { character: 'T', video: 'https://www.youtube.com/embed/VIDEO_ID_T' },
              { character: 'U', video: 'https://www.youtube.com/embed/VIDEO_ID_U'},
              { character: 'Ư', video: 'https://www.youtube.com/embed/VIDEO_ID_OO'},
              { character: 'V', video: 'https://www.youtube.com/embed/VIDEO_ID_V' },
              { character: 'X', video: 'https://www.youtube.com/embed/VIDEO_ID_X' },
              { character: 'Y', video: 'https://www.youtube.com/embed/VIDEO_ID_Y'}
          ],
          
          vowels: [
              { character: 'A', video: 'https://www.youtube.com/embed/VIDEO_ID_A' },
              { character: 'Ă', video: 'https://www.youtube.com/embed/VIDEO_ID_AW' },
              { character: 'Â', video: 'https://www.youtube.com/embed/VIDEO_ID_UH' },
              { character: 'E', video: 'https://www.youtube.com/embed/VIDEO_ID_E' },
              { character: 'Ê', video: 'https://www.youtube.com/embed/VIDEO_ID_EY' },
              { character: 'I', video: 'https://www.youtube.com/embed/VIDEO_ID_I' },
              { character: 'O', video: 'https://www.youtube.com/embed/VIDEO_ID_O' },
              { character: 'Ô', video: 'https://www.youtube.com/embed/VIDEO_ID_OH' },
              { character: 'Ơ', video: 'https://www.youtube.com/embed/VIDEO_ID_UHOH' },
              { character: 'U', video: 'https://www.youtube.com/embed/VIDEO_ID_U' },
              { character: 'Ư', video: 'https://www.youtube.com/embed/VIDEO_ID_OO' },
              { character: 'Y', video: 'https://www.youtube.com/embed/VIDEO_ID_Y' }
          ],
          
          consonants: [
              { character: 'B', video: 'https://www.youtube.com/embed/VIDEO_ID_B' },
              { character: 'C', video: 'https://www.youtube.com/embed/VIDEO_ID_C' },
              { character: 'D', video: 'https://www.youtube.com/embed/VIDEO_ID_D' },
              { character: 'Đ', video: 'https://www.youtube.com/embed/VIDEO_ID_DD' },
              { character: 'F', video: 'https://www.youtube.com/embed/VIDEO_ID_F' },
              { character: 'G', video: 'https://www.youtube.com/embed/VIDEO_ID_G' },
              { character: 'H', video: 'https://www.youtube.com/embed/VIDEO_ID_H' },
              { character: 'K', video: 'https://www.youtube.com/embed/VIDEO_ID_K' },
              { character: 'L', video: 'https://www.youtube.com/embed/VIDEO_ID_L' },
              { character: 'M', video: 'https://www.youtube.com/embed/VIDEO_ID_M' },
              { character: 'N', video: 'https://www.youtube.com/embed/VIDEO_ID_N' },
              { character: 'P', video: 'https://www.youtube.com/embed/VIDEO_ID_P' },
              { character: 'Q', video: 'https://www.youtube.com/embed/VIDEO_ID_Q' },
              { character: 'R', video: 'https://www.youtube.com/embed/VIDEO_ID_R' },
              { character: 'S', video: 'https://www.youtube.com/embed/VIDEO_ID_S' },
              { character: 'T', video: 'https://www.youtube.com/embed/VIDEO_ID_T' },
              { character: 'V', video: 'https://www.youtube.com/embed/VIDEO_ID_V' },
              { character: 'X', video: 'https://www.youtube.com/embed/VIDEO_ID_X' }
          ],
          
          showVideo(letter) {
              this.currentVideo = letter.video;
              this.currentLetter = letter;
          },
          
          closeVideo() {
              this.currentVideo = null;
              this.currentLetter = null;
          }
      }));
  });
</script>
<script>
  document.addEventListener('alpine:init', () => {
      Alpine.data('speakingTool', () => ({
          activeTab: 'images',
          images: [],
          topics: [],
          newTopic: '',
          selectedTime: 2,
          timeLeft: 120, // in seconds
          timerInterval: null,
          isRunning: false,
          isPaused: false,
          isComplete: false,
          currentImage: '',
          currentTopic: '',
          circumference: 2 * Math.PI * 40,

          init() {
              // Load saved data from localStorage
              this.loadSavedData();
              
              // Set initial current items
              if (this.images.length > 0) {
                  this.currentImage = this.images[0].url;
              }
              if (this.topics.length > 0) {
                  this.currentTopic = this.topics[0];
              }
              
              // Set initial time based on selectedTime
              this.timeLeft = this.selectedTime * 60;
          },

          handleImageUpload(event) {
              const files = event.target.files;
              if (!files) return;
              
              for (let i = 0; i < files.length; i++) {
                  const file = files[i];
                  if (file.size > 5 * 1024 * 1024) {
                      alert('File size exceeds 5MB limit');
                      continue;
                  }
                  
                  const reader = new FileReader();
                  reader.onload = (e) => {
                      this.images.push({
                          url: e.target.result,
                          name: file.name
                      });
                      this.saveData();
                      
                      // Set current image if none is set
                      if (!this.currentImage) {
                          this.currentImage = e.target.result;
                      }
                  };
                  reader.readAsDataURL(file);
              }
              
              // Reset file input
              event.target.value = '';
          },

          removeImage(index) {
              this.images.splice(index, 1);
              this.saveData();
              
              // Update current image if needed
              if (this.images.length === 0) {
                  this.currentImage = '';
              } else if (this.currentImage === this.images[index]?.url) {
                  this.currentImage = this.images[0]?.url || '';
              }
          },

          addTopic() {
              if (this.newTopic.trim() === '') return;
              
              this.topics.push(this.newTopic.trim());
              this.newTopic = '';
              this.saveData();
              
              // Set current topic if none is set
              if (!this.currentTopic) {
                  this.currentTopic = this.topics[0];
              }
          },

          removeTopic(index) {
              this.topics.splice(index, 1);
              this.saveData();
              
              // Update current topic if needed
              if (this.topics.length === 0) {
                  this.currentTopic = '';
              } else if (this.currentTopic === this.topics[index]) {
                  this.currentTopic = this.topics[0] || '';
              }
          },

          setTimer(minutes) {
              this.selectedTime = minutes;
              this.resetTimer();
          },

          startTimer() {
              if ((this.activeTab === 'images' && this.images.length === 0) || 
                  (this.activeTab === 'topics' && this.topics.length === 0)) {
                  return;
              }
              
              // Set random prompt if not already set
              if (this.activeTab === 'images' && this.images.length > 0) {
                  const randomIndex = Math.floor(Math.random() * this.images.length);
                  this.currentImage = this.images[randomIndex].url;
              } else if (this.activeTab === 'topics' && this.topics.length > 0) {
                  const randomIndex = Math.floor(Math.random() * this.topics.length);
                  this.currentTopic = this.topics[randomIndex];
              }
              
              this.timeLeft = this.selectedTime * 60;
              this.isRunning = true;
              this.isPaused = false;
              this.isComplete = false;
              
              this.timerInterval = setInterval(() => {
                  if (this.timeLeft > 0) {
                      this.timeLeft--;
                  } else {
                      this.completeTimer();
                  }
              }, 1000);
          },

          pauseTimer() {
              if (this.timerInterval) {
                  clearInterval(this.timerInterval);
                  this.timerInterval = null;
                  this.isPaused = true;
                  this.isRunning = false;
              }
          },

          resumeTimer() {
              if (this.isPaused) {
                  this.isRunning = true;
                  this.isPaused = false;
                  
                  this.timerInterval = setInterval(() => {
                      if (this.timeLeft > 0) {
                          this.timeLeft--;
                      } else {
                          this.completeTimer();
                      }
                  }, 1000);
              }
          },

          resetTimer() {
              if (this.timerInterval) {
                  clearInterval(this.timerInterval);
                  this.timerInterval = null;
              }
              
              this.timeLeft = this.selectedTime * 60;
              this.isRunning = false;
              this.isPaused = false;
              this.isComplete = false;
          },

          completeTimer() {
              clearInterval(this.timerInterval);
              this.timerInterval = null;
              this.isRunning = false;
              this.isComplete = true;
              
              // Play completion sound
              const audio = new Audio('https://assets.mixkit.co/sfx/preview/mixkit-alarm-digital-clock-beep-989.mp3');
              audio.play();
          },

          formatTime(seconds) {
              const mins = Math.floor(seconds / 60);
              const secs = seconds % 60;
              return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
          },

          saveData() {
              localStorage.setItem('fluencyToolImages', JSON.stringify(this.images));
              localStorage.setItem('fluencyToolTopics', JSON.stringify(this.topics));
          },

          loadSavedData() {
              const savedImages = localStorage.getItem('fluencyToolImages');
              const savedTopics = localStorage.getItem('fluencyToolTopics');
              
              if (savedImages) {
                  this.images = JSON.parse(savedImages);
              }
              
              if (savedTopics) {
                  this.topics = JSON.parse(savedTopics);
              }
          }
      }));
  });
</script>
<script>
    function flashcardApp() {
        return {
            fileName: '',
            flashcards: [],
            currentIndex: 0,
            isFlipped: false,
            showVideoModal: false,
            currentVideoUrl: '',
            audioElement: null,
            
            get currentFlashcard() {
                return this.flashcards[this.currentIndex] || {};
            },
            
            loadFile(event) {
                const file = event.target.files[0];
                if (!file) return;
                
                this.fileName = file.name;
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (!Array.isArray(data)) {
                            alert('The file should contain an array of flashcards');
                            return;
                        }
                        
                        this.flashcards = data.map(card => ({
                            frontText: card.frontText || '',
                            image: card.image || null,
                            audio: card.audio || null,
                            video: card.video || null,
                            backText: card.backText || 'No explanation provided'
                        }));
                        
                        this.currentIndex = 0;
                        this.isFlipped = false;
                        
                        if (this.currentFlashcard.audio) {
                            this.preloadAudio(this.currentFlashcard.audio);
                        }
                        
                    } catch (error) {
                        alert('Error parsing JSON file: ' + error.message);
                    }
                };
                
                reader.readAsText(file);
                event.target.value = '';
            },
            
            loadDemo(category) {
                this.fileName = `${category.charAt(0).toUpperCase() + category.slice(1)} Flashcards`;
                
                const demoData = {
                    food: [
                        {
                            frontText: "What fruit is known for its yellow peel and soft flesh?",
                            image: "https://upload.wikimedia.org/wikipedia/commons/4/43/Ambersweet_Oranges.jpg",
                            audio: "https://audio12.forvo.com/mp3/8972992/39/8972992_39_6922702.mp3",
                            video: "https://www.youtube.com/watch?v=bLY0iyOY-VA",
                            backText: "Banana"
                        },
                        {
                            frontText: "What is a common Italian dish made with dough, sauce, and cheese?",
                            image: null,
                            audio: null,
                            video: null,
                            backText: "Pizza"
                        }
                    ],
                    animals: [
                        {
                            frontText: "What animal is known as man's best friend?",
                            image: "https://upload.wikimedia.org/wikipedia/commons/d/d9/Collage_of_Nine_Dogs.jpg",
                            audio: "https://audio12.forvo.com/mp3/8972992/39/8972992_39_6922702.mp3",
                            video: "https://www.youtube.com/watch?v=bLY0iyOY-VA",
                            backText: "Dog"
                        },
                        {
                            frontText: "What large mammal lives in the ocean and breathes air?",
                            image: null,
                            audio: null,
                            video: null,
                            backText: "Whale"
                        }
                    ],
                    geography: [
                        {
                            frontText: "What is the capital city of Brazil?",
                            image: null,
                            audio: "https://audio12.forvo.com/mp3/8972992/39/8972992_39_6922702.mp3",
                            video: "https://www.youtube.com/watch?v=bLY0iyOY-VA",
                            backText: "Brasília"
                        },
                        {
                            frontText: "What is the largest continent by land area?",
                            image: "https://upload.wikimedia.org/wikipedia/commons/3/3c/Asia_%28orthographic_projection%29.svg",
                            audio: null,
                            video: null,
                            backText: "Asia"
                        }
                    ]
                };
                
                try {
                    const selectedData = demoData[category] || [];
                    if (selectedData.length === 0) {
                        alert('No demo data available for this category');
                        return;
                    }
                    
                    this.flashcards = selectedData.map(card => ({
                        frontText: card.frontText || '',
                        image: card.image || null,
                        audio: card.audio || null,
                        video: card.video || null,
                        backText: card.backText || 'No explanation provided'
                    }));
                    
                    this.currentIndex = 0;
                    this.isFlipped = false;
                    
                    if (this.currentFlashcard.audio) {
                        this.preloadAudio(this.currentFlashcard.audio);
                    }
                } catch (error) {
                    alert('Error loading demo flashcards: ' + error.message);
                }
            },
            
            toggleFlip() {
                this.isFlipped = !this.isFlipped;
            },
            
            nextCard() {
                if (this.currentIndex < this.flashcards.length - 1) {
                    this.currentIndex++;
                    this.isFlipped = false;
                    
                    if (this.currentFlashcard.audio) {
                        this.preloadAudio(this.currentFlashcard.audio);
                    }
                }
            },
            
            prevCard() {
                if (this.currentIndex > 0) {
                    this.currentIndex--;
                    this.isFlipped = false;
                    
                    if (this.currentFlashcard.audio) {
                        this.preloadAudio(this.currentFlashcard.audio);
                    }
                }
            },
            
            shuffleFlashcards() {
                for (let i = this.flashcards.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [this.flashcards[i], this.flashcards[j]] = [this.flashcards[j], this.flashcards[i]];
                }
                this.currentIndex = 0;
                this.isFlipped = false;
            },
            
            resetFlashcards() {
                this.currentIndex = 0;
                this.isFlipped = false;
            },
            
            playAudio(audioUrl) {
                if (this.audioElement) {
                    this.audioElement.pause();
                }
                
                this.audioElement = new Audio(audioUrl);
                this.audioElement.play().catch(e => {
                    console.error('Audio playback failed:', e);
                    alert('Could not play audio: ' + e.message);
                });
            },
            
            preloadAudio(audioUrl) {
                if (this.audioElement) {
                    this.audioElement.pause();
                }
                
                this.audioElement = new Audio(audioUrl);
                this.audioElement.preload = 'auto';
            },
            
            showVideo(videoUrl) {
                if (videoUrl.includes('youtube.com/watch')) {
                    const videoId = videoUrl.split('v=')[1];
                    const ampersandPosition = videoId.indexOf('&');
                    if (ampersandPosition !== -1) {
                        this.currentVideoUrl = `https://www.youtube.com/embed/${videoId.substring(0, ampersandPosition)}`;
                    } else {
                        this.currentVideoUrl = `https://www.youtube.com/embed/${videoId}`;
                    }
                } else {
                    this.currentVideoUrl = videoUrl;
                }
                
                this.showVideoModal = true;
            },
            
            closeVideoModal() {
                this.currentVideoUrl = '';
                this.showVideoModal = false;
            }
        }
    }
</script>